fileVersion: 1
id: e7728620-9461-45d9-a1b7-d2d47a400ad1
name: FCT_NODE_GROWTH_RATE
operation:
  config:
    groupByAll: false
    insertStrategy: UNION ALL
    orderby: false
    orderbycolumn:
      items:
        - {}
    postSQL: ""
    preSQL: ""
    selectDistinct: false
    testsEnabled: false
    truncateBefore: true
  database: ""
  deployEnabled: true
  description: ""
  isMultisource: false
  locationName: TARGET
  materializationType: table
  metadata:
    appliedNodeTests: []
    columns:
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 0446d74a-7e1a-4e0c-b9ee-785fd1174ec9
          stepCounter: e7728620-9461-45d9-a1b7-d2d47a400ad1
        config: {}
        dataType: STRING
        description: |-
          -  Represents the unique identifier for the account associated with the opportunity. 
          - Sourced from the 'opportunity' table's 'account_id' column. 
          - Used for joining and linking with the account table to access account-specific information.
        name: account_id
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: b60dd383-780b-4ee7-a293-4ea4d7b5a3bb
                stepCounter: 04cf093c-b308-4620-b42e-8b9b37fe6b74
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 05e3177d-2a64-4fb2-8d58-e86a98bf276d
          stepCounter: e7728620-9461-45d9-a1b7-d2d47a400ad1
        config: {}
        dataType: STRING
        description: ""
        name: account_name
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 0c294d13-37e4-4cd7-a008-40a0d265053f
                stepCounter: 04cf093c-b308-4620-b42e-8b9b37fe6b74
            transform: ""
      - acceptedValues:
          strictMatch: true
          values: []
        appliedColumnTests: {}
        columnReference:
          columnCounter: 59bb7f24-71d2-4da5-b1ad-edbea7358fd2
          stepCounter: e7728620-9461-45d9-a1b7-d2d47a400ad1
        config: {}
        dataType: STRING
        defaultValue: ""
        description: ""
        keyColumnType: None
        name: arr_cohort
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 2c1575c1-6d41-48d1-b45b-7ee3c2770485
                stepCounter: fd4e02ac-7658-4fa5-b6e5-0fc943fb8778
            transform: ""
        systemColumnType: None
      - acceptedValues:
          strictMatch: false
          values: []
        appliedColumnTests: {}
        columnReference:
          columnCounter: bc465d50-5d6b-4300-a52c-14ee66313a4c
          stepCounter: e7728620-9461-45d9-a1b7-d2d47a400ad1
        config: {}
        dataType: INTEGER
        description: ""
        name: account_tenure
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 0b180d7a-c5af-43a7-8848-f251c80273ca
                stepCounter: fd4e02ac-7658-4fa5-b6e5-0fc943fb8778
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 57170139-cb7a-4084-85b4-9f32d1db3656
          stepCounter: e7728620-9461-45d9-a1b7-d2d47a400ad1
        config: {}
        dataType: DATE
        description: ""
        name: node_month
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 8fe7349f-223f-4b2d-986e-d5c9c1fbb699
                stepCounter: 04cf093c-b308-4620-b42e-8b9b37fe6b74
            transform: ""
      - acceptedValues:
          strictMatch: true
          values: []
        appliedColumnTests: {}
        columnReference:
          columnCounter: bda1c75b-fcf7-4d17-a97f-9143292b92d5
          stepCounter: e7728620-9461-45d9-a1b7-d2d47a400ad1
        config: {}
        dataType: DOUBLE
        defaultValue: ""
        description: ""
        keyColumnType: None
        name: node_growth_rate
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: CASE WHEN LAG(`FCT_MONTHLY_NODE_COUNT`.`node_count`) OVER (PARTITION BY `FCT_MONTHLY_NODES_BUILT`.`account_id` ORDER BY `FCT_MONTHLY_NODES_BUILT`.`node_month`) = 0 AND `FCT_MONTHLY_NODES_BUILT`.`nodes_built` > 0 THEN 1 WHEN LAG(`FCT_MONTHLY_NODE_COUNT`.`node_count`) OVER (PARTITION BY `FCT_MONTHLY_NODES_BUILT`.`account_id` ORDER BY `FCT_MONTHLY_NODES_BUILT`.`node_month`) > 0 THEN `nodes_built` / LAG(`FCT_MONTHLY_NODE_COUNT`.`node_count`) OVER (PARTITION BY `FCT_MONTHLY_NODES_BUILT`.`account_id` ORDER BY `FCT_MONTHLY_NODES_BUILT`.`node_month`) ELSE 0 END
        systemColumnType: None
      - acceptedValues:
          strictMatch: true
          values: []
        appliedColumnTests: {}
        columnReference:
          columnCounter: c9880034-9528-4807-af96-d8cd6a39d537
          stepCounter: e7728620-9461-45d9-a1b7-d2d47a400ad1
        config: {}
        dataType: STRING
        defaultValue: ""
        description: ""
        keyColumnType: None
        name: metric_name
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: "0"
                stepCounter: "0"
            transform: "'node_growth_rate'"
        systemColumnType: None
    cteString: ""
    enabledColumnTestIDs: []
    sourceMapping:
      - aliases:
          FCT_MONTHLY_NODES_BUILT: 04cf093c-b308-4620-b42e-8b9b37fe6b74
        customSQL:
          customSQL: ""
        dependencies:
          - locationName: TARGET
            nodeName: FCT_MONTHLY_NODE_COUNT
          - locationName: TARGET
            nodeName: FCT_MONTHLY_NODES_BUILT
        join:
          joinCondition: |-
            FROM {{ ref('TARGET', 'FCT_MONTHLY_NODES_BUILT') }} `FCT_MONTHLY_NODES_BUILT`
            INNER JOIN {{ ref('TARGET', 'FCT_MONTHLY_NODE_COUNT') }} `FCT_MONTHLY_NODE_COUNT`
            ON `FCT_MONTHLY_NODES_BUILT`.`account_id` = `FCT_MONTHLY_NODE_COUNT`.`account_id`
            AND `FCT_MONTHLY_NODES_BUILT`.`node_month` = `FCT_MONTHLY_NODE_COUNT`.`node_month`
            ORDER BY `FCT_MONTHLY_NODES_BUILT`.`account_id` asc, `FCT_MONTHLY_NODES_BUILT`.`node_month` asc
        name: FCT_NODE_GROWTH_RATE
        noLinkRefs: []
  name: FCT_NODE_GROWTH_RATE
  overrideSQL: false
  schema: ""
  sqlType: Fact
  type: sql
  version: 1
type: Node
