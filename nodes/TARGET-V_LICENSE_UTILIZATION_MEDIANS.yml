fileVersion: 1
id: d08c265a-8366-41f8-8282-8215646062a0
name: V_LICENSE_UTILIZATION_MEDIANS
operation:
  config:
    OverrideSQLCreate: false
    groupByAll: false
    insertStrategy: UNION
    selectDistinct: false
  database: ""
  deployEnabled: true
  description: ""
  isMultisource: false
  locationName: TARGET
  materializationType: view
  metadata:
    appliedNodeTests: []
    columns:
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 566eb582-cb1f-4839-b31e-93d1427fc233
          stepCounter: d08c265a-8366-41f8-8282-8215646062a0
        config: {}
        dataType: STRING
        description: |-
          -  Represents the unique identifier for the account associated with the opportunity. 
          - Sourced from the 'opportunity' table's 'account_id' column. 
          - Used for joining and linking with the account table to access account-specific information.
        name: account_id
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: c0fe604b-a1f7-468b-a1f1-cc24a8fd7c6a
                stepCounter: 38b83add-a489-4eec-ab95-db8710f98a49
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: cd6b2b31-42ef-4ae2-a408-b49418f027d9
          stepCounter: d08c265a-8366-41f8-8282-8215646062a0
        config: {}
        dataType: STRING
        description: ""
        name: account_name
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 5854281b-04a4-4b22-a82f-6e9c8734b9a3
                stepCounter: 38b83add-a489-4eec-ab95-db8710f98a49
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 17d08b37-5f87-4171-b53d-716d4d1b98f1
          stepCounter: d08c265a-8366-41f8-8282-8215646062a0
        config: {}
        dataType: DATE
        description: ""
        name: month_start
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 4dd94da1-1cd6-469f-a341-9cc2fd500213
                stepCounter: 38b83add-a489-4eec-ab95-db8710f98a49
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 958afb06-48ca-4f34-8eb4-5f92d4d46af7
          stepCounter: d08c265a-8366-41f8-8282-8215646062a0
        config: {}
        dataType: STRING
        description: ""
        name: arr_cohort
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 4c5c1719-d63f-450d-a420-41691ec7ebca
                stepCounter: 38b83add-a489-4eec-ab95-db8710f98a49
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 2cf23a90-e7d5-4077-9493-f3c4aa400034
          stepCounter: d08c265a-8366-41f8-8282-8215646062a0
        config: {}
        dataType: INTEGER
        description: ""
        name: account_tenure
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 7c0128c2-b1f9-4e29-9afa-d797b03d1229
                stepCounter: 38b83add-a489-4eec-ab95-db8710f98a49
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: b25c2755-12e9-4f2a-9a03-6b9c153f1e51
          stepCounter: d08c265a-8366-41f8-8282-8215646062a0
        config: {}
        dataType: INTEGER
        description: ""
        name: license_count
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: d48f5dde-7639-46f1-b309-7e6059424137
                stepCounter: 38b83add-a489-4eec-ab95-db8710f98a49
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 249c9e71-5fc4-474e-9ea7-b0e1dca89917
          stepCounter: d08c265a-8366-41f8-8282-8215646062a0
        config: {}
        dataType: INTEGER
        description: ""
        name: licensed_users
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 7d71ebdf-da5e-4984-89e5-a5a503d20395
                stepCounter: 38b83add-a489-4eec-ab95-db8710f98a49
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 299cd206-6633-4a12-bdfa-30ccfa0fff53
          stepCounter: d08c265a-8366-41f8-8282-8215646062a0
        config: {}
        dataType: DOUBLE
        description: ""
        name: license_utilization
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 929b4e00-0c5c-4ee3-a0ce-54fe4eface63
                stepCounter: 38b83add-a489-4eec-ab95-db8710f98a49
            transform: ""
    cteString: ""
    enabledColumnTestIDs: []
    sourceMapping:
      - aliases: {}
        customSQL:
          customSQL: |-
            {{ stage('Override Create SQL') }}
            	CREATE OR REPLACE VIEW {{ ref('TARGET', 'V_LICENSE_UTILIZATION_MEDIANS')}} AS (
            with `source_100K+` as (
            select *
            from customer_health_metrics.default.fct_license_utilization
            where account_tenure > 6
            and arr_cohort = '100K+'
            ),


            `100K+` as (
            select
             'license_utilization' as metric_name, 
             '100K+' as arr_cohort,
             median(distinct license_utilization) as metric_median
            from
             `source_100K+`
            group by all
            ),


            `source_50K-100K` as (
            select *
            from customer_health_metrics.default.fct_license_utilization
            where account_tenure > 6
            and arr_cohort = '50K-100K'
            ),


            `50K-100K` as (
            select
             'license_utilization' as metric_name, 
             '50K-100K' as arr_cohort,
             median(distinct license_utilization) as metric_median
            from
             `source_50K-100K`
            group by all
            ),


            `source_30K-50K` as (
            select *
            from customer_health_metrics.default.fct_license_utilization
            where account_tenure > 6
            and arr_cohort = '30K-50K'
            ),


            `30K-50K` as (
            select
             'license_utilization' as metric_name, 
             '30K-50K' as arr_cohort,
             median(distinct license_utilization) as metric_median
            from
             `source_30K-50K`
            group by all
            ),


            `source_0-30K` as (
            select *
            from customer_health_metrics.default.fct_license_utilization
            where account_tenure > 6
            and arr_cohort = '0-30K'
            ),


            `0-30K` as (
            select
             'license_utilization' as metric_name, 
             '0-30K' as arr_cohort,
             median(distinct license_utilization) as metric_median
            from
             `source_0-30K`
            group by all
            )


            select *
            from `100K+`
            UNION
            select *
            from `50K-100K`
            UNION
            select *
            from `30K-50K`
            UNION
            select *
            from `0-30K`)
        dependencies:
          - locationName: TARGET
            nodeName: FCT_LICENSE_UTILIZATION
        join:
          joinCondition: FROM {{ ref('TARGET', 'FCT_LICENSE_UTILIZATION') }} `FCT_LICENSE_UTILIZATION`
        name: V_LICENSE_UTILIZATION_MEDIANS
        noLinkRefs: []
  name: V_LICENSE_UTILIZATION_MEDIANS
  overrideSQL: true
  schema: ""
  sqlType: View
  type: sql
  version: 1
type: Node
